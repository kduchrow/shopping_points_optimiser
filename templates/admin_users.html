{% extends "base.html" %} {% block title %}User-Verwaltung - Admin{% endblock %} {% block nav %}
<nav class="top-nav">
  <a class="nav-link" href="/admin">â† Admin Panel</a>
  <a class="nav-link" href="/">ğŸ  Startseite</a>
  <a class="nav-link" href="/logout">ğŸšª Logout</a>
</nav>
{% endblock %} {% block content %}
<div class="card wide">
  <h1>ğŸ‘¥ User-Verwaltung</h1>

  <h2>Alle registrierten User ({{ users|length }})</h2>

  {% if users|length > 0 %}
  <table class="user-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Username</th>
        <th>Email</th>
        <th>Rolle</th>
        <th>Status</th>
        <th>Registriert</th>
        <th>Aktionen</th>
      </tr>
    </thead>
    <tbody>
      {% for user in users %}
      <tr>
        <td>{{ user.id }}</td>
        <td><strong>{{ user.username }}</strong></td>
        <td>{{ user.email }}</td>
        <td>
          <span class="role-badge role-{{ user.role }}">{{ user.role }}</span>
        </td>
        <td>
          <span class="status-badge status-{{ user.status }}">{{ user.status }}</span>
        </td>
        <td>{{ user.created_at.strftime('%d.%m.%Y') }}</td>
        <td>
          <!-- prettier-ignore -->
          <form action="/admin/users/{{ user.id }}/update_role" method="POST" class="action-form">
            <select name="role" onchange="this.form.submit()">
              <option value="">Rolle Ã¤ndern...</option>
              <option value="viewer" {% if user.role == "viewer" %}disabled{% endif %}>Viewer</option>
              <option value="user" {% if user.role == "user" %}disabled{% endif %}>User</option>
              <option value="contributor" {% if user.role == "contributor" %}disabled{% endif %}>Contributor</option>
              <option value="admin" {% if user.role == "admin" %}disabled{% endif %}>Admin</option>
            </select>
          </form>

          <form
            action="/admin/users/{{ user.id }}/toggle_status"
            method="POST"
            class="action-form"
            onsubmit="return confirm('Status von {{ user.username }} wirklich Ã¤ndern?');"
          >
            {% if user.status == 'active' %}
            <button type="submit" class="btn btn-sm btn-warning">ğŸ”’ Deaktivieren</button>
            {% else %}
            <button type="submit" class="btn btn-sm btn-success">âœ… Aktivieren</button>
            {% endif %}
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <div class="empty-state">
    <p>Keine User gefunden.</p>
  </div>
  {% endif %}

  <h2 class="mt-30">â„¹ï¸ Rollen-ErklÃ¤rung</h2>
  <ul class="line-height-1-8 pl-20">
    <li><strong>Viewer:</strong> Kann nur Ã¶ffentliche Inhalte sehen</li>
    <li><strong>User:</strong> Kann Proposals erstellen</li>
    <li><strong>Contributor:</strong> Kann Proposals erstellen und Ã¼ber Proposals abstimmen</li>
    <li><strong>Admin:</strong> Volle Rechte (User-Verwaltung, Scrapers, Proposals direkt genehmigen)</li>
  </ul>
</div>
{% endblock %}
