{% extends "base.html" %} {% block title %}{% if job %}Job bearbeiten{% else %}Job erstellen{% endif %} - Admin{%
endblock %} {% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}" />
<style>
  .form-group {
    margin-bottom: 20px;
  }
  .form-group label {
    display: block;
    font-weight: bold;
    margin-bottom: 8px;
  }
  .form-group input[type="text"],
  .form-group select {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 16px;
  }
  .form-group input[type="checkbox"] {
    width: auto;
    margin-right: 8px;
  }
  .form-actions {
    display: flex;
    gap: 12px;
    margin-top: 30px;
  }
  .help-text {
    color: #6c757d;
    font-size: 14px;
    margin-top: 4px;
  }
</style>
{% endblock %} {% block nav %}
<nav class="top-nav">
  <span class="flex-1 text-muted">ğŸ‘¤ {{ current_user.username }}</span>
  <a class="nav-link" href="/">ğŸ  Startseite</a>
  <a class="nav-link" href="/admin">ğŸ› ï¸ Admin Panel</a>
  <!-- Removed Scheduled Jobs link to avoid confusion -->
  <a class="nav-link" href="/logout">ğŸšª Logout</a>
</nav>
{% endblock %} {% block content %}
<div class="admin-card" style="max-width: 700px; margin: 0 auto;">
  <h1 style="margin-bottom: 24px;">{% if job %}âœï¸ Job bearbeiten{% else %}â• Neuen Job erstellen{% endif %}</h1>

  <form method="POST">
    <div class="form-group">
      <label for="job_name">Job Name *</label>
      <input
        type="text"
        id="job_name"
        name="job_name"
        value="{% if job %}{{ job.job_name }}{% endif %}"
        required
        {%
        if
        job
        %}readonly{%
        endif
        %}
      />
      <div class="help-text">Eindeutiger Name fÃ¼r den Job (z.B. "daily_shop_deduplication")</div>
    </div>

    <div class="form-group">
      <label for="job_type">Job Type *</label>
      <select id="job_type" name="job_type" required>
        <option value="">-- Bitte wÃ¤hlen --</option>
        {% for job_type in available_job_types %}
        <option value="{{ job_type }}" {% if job and job.job_type == job_type %}selected{% endif %}>
          {{ job_type | replace('_', ' ') | title }}
        </option>
        {% endfor %}
      </select>
      <div class="help-text">Art des Jobs der ausgefÃ¼hrt werden soll</div>
    </div>

    <div class="form-group">
      <label for="cron_expression">Cron Expression *</label>
      <input
        type="text"
        id="cron_expression"
        name="cron_expression"
        value="{% if job %}{{ job.cron_expression }}{% else %}0 2 * * *{% endif %}"
        required
        placeholder="0 2 * * *"
      />
      <div class="help-text">
        Zeitplan im Cron-Format (z.B. "0 2 * * *" fÃ¼r tÃ¤glich um 2:00 Uhr)
        <br />
        <a href="https://crontab.guru/" target="_blank">Cron Expression Generator â†’</a>
      </div>
    </div>

    <div class="form-group">
      <label>
        <input type="checkbox" id="enabled" name="enabled" {% if not job or job.enabled %}checked{% endif %} />
        Job aktiviert
      </label>
      <div class="help-text">Job wird nur ausgefÃ¼hrt wenn aktiviert</div>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn btn-primary">{% if job %}ğŸ’¾ Speichern{% else %}â• Erstellen{% endif %}</button>
      <a href="/admin" class="btn btn-secondary"> âŒ Abbrechen </a>
    </div>
  </form>

  {% if job %}
  <div style="margin-top: 40px; padding: 20px; background-color: #f8f9fa; border-radius: 8px; border: 1px solid #e0e7ef;">
    <h3 style="margin-bottom: 12px;">ğŸ“Š Job Informationen</h3>
    <p><strong>Erstellt am:</strong> {{ job.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>
    <p><strong>Letztes Update:</strong> {{ job.updated_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>
    {% if job.last_run_at %}
    <p><strong>Letzter Lauf:</strong> {{ job.last_run_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>
    <p><strong>Status:</strong> {{ job.last_run_status or 'N/A' }}</p>
    {% if job.last_run_message %}
    <p><strong>Nachricht:</strong> {{ job.last_run_message }}</p>
    {% endif %} {% endif %}
  </div>
  {% endif %}
</div>
{% endblock %}
