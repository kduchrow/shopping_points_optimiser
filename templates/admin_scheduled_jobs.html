{% extends "base.html" %} {% block title %}Scheduled Jobs - Admin{% endblock %} {% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}" />
<style>
  .jobs-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
  }
  .jobs-table th,
  .jobs-table td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #ddd;
  }
  .jobs-table th {
    background-color: #f5f5f5;
    font-weight: bold;
  }
  .job-enabled {
    color: #28a745;
    font-weight: bold;
  }
  .job-disabled {
    color: #6c757d;
  }
  .status-success {
    color: #28a745;
  }
  .status-failed {
    color: #dc3545;
  }
  .status-queued {
    color: #007bff;
  }
  .btn-group {
    display: flex;
    gap: 8px;
  }
  .btn-sm {
    padding: 6px 8px;
    font-size: 16px;
    line-height: 1;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 32px;
  }
  .btn-sm .icon {
    font-size: 16px;
    line-height: 1;
  }
  .status-icon {
    font-size: 14px;
  }
</style>
{% endblock %} {% block nav %}
<nav class="top-nav">
  <span class="flex-1 text-muted">ğŸ‘¤ {{ current_user.username }}</span>
  <a class="nav-link" href="/">ğŸ  Startseite</a>
  <a class="nav-link" href="/admin">ğŸ› ï¸ Admin Panel</a>
  <a class="nav-link" href="/logout">ğŸšª Logout</a>
</nav>
{% endblock %} {% block content %}
<div class="card wide">
  <div style="display: flex; justify-content: space-between; align-items: center">
    <h1>â° Scheduled Jobs</h1>
    <a href="{{ url_for('admin_create_scheduled_job') }}" class="btn btn-primary"> â• Neuen Job erstellen </a>
  </div>

  {% if jobs|length == 0 %}
  <p class="text-muted">Keine Scheduled Jobs vorhanden.</p>
  {% else %}
  <table class="jobs-table">
    <thead>
      <tr>
        <th>Job Name</th>
        <th>Job Type</th>
        <th>Cron Expression</th>
        <th>Status</th>
        <th>Letzter Lauf</th>
        <th>Ergebnis</th>
        <th>Aktionen</th>
      </tr>
    </thead>
    <tbody>
      {% for job in jobs %}
      <tr>
        <td><strong>{{ job.job_name }}</strong></td>
        <td>{{ job.job_type }}</td>
        <td><code>{{ job.cron_expression }}</code></td>
        <td>
          {% if job.enabled %}
          <span class="job-enabled">âœ… Aktiviert</span>
          {% else %}
          <span class="job-disabled">â¸ï¸ Deaktiviert</span>
          {% endif %}
        </td>
        <td>
          {% if job.last_run_at %} {{ job.last_run_at.strftime('%Y-%m-%d %H:%M:%S') }} {% else %}
          <span class="text-muted">Noch nicht ausgefÃ¼hrt</span>
          {% endif %}
        </td>
        <td>
          {% if job.last_run_status == 'success' %}
          <span class="status-success">âœ… Erfolgreich</span>
          {% elif job.last_run_status == 'failed' %}
          <span class="status-failed">âŒ Fehlgeschlagen</span>
          {% elif job.last_run_status == 'queued' %}
          <span class="status-queued">â³ In Warteschlange</span>
          {% else %}
          <span class="text-muted">â€”</span>
          {% endif %} {% if job.last_run_message %}
          <br />
          <small class="text-muted">{{ job.last_run_message }}</small>
          {% endif %}
        </td>
        <td>
          <div class="btn-group">
            <a
              href="{{ url_for('admin_edit_scheduled_job', job_id=job.id) }}"
              class="btn btn-sm btn-secondary"
              title="Job bearbeiten"
            >
              âœï¸
            </a>
            <form
              method="POST"
              action="{{ url_for('admin_run_scheduled_job', job_id=job.id) }}"
              style="display: inline"
            >
              <button type="submit" class="btn btn-sm btn-success" title="Jetzt ausfÃ¼hren">â–¶ï¸</button>
            </form>
            <form
              method="POST"
              action="{{ url_for('admin_toggle_scheduled_job', job_id=job.id) }}"
              style="display: inline"
            >
              <button
                type="submit"
                class="btn btn-sm btn-primary"
                title="{% if job.enabled %}Deaktivieren{% else %}Aktivieren{% endif %}"
              >
                {% if job.enabled %}â¸ï¸{% else %}â–¶ï¸{% endif %}
              </button>
            </form>
            <form
              method="POST"
              action="{{ url_for('admin_delete_scheduled_job', job_id=job.id) }}"
              onsubmit="return confirm('Job \'{{ job.job_name }}\' wirklich lÃ¶schen?');"
              style="display: inline"
            >
              <button type="submit" class="btn btn-sm btn-danger" title="Job lÃ¶schen">ğŸ—‘ï¸</button>
            </form>
            <a
              href="{{ url_for('admin_scheduled_job_logs', job_id=job.id) }}"
              class="btn btn-sm btn-secondary"
              title="Logs anzeigen"
            >
              ğŸ“œ
            </a>
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}

  <div style="margin-top: 30px; padding: 20px; background-color: #f8f9fa; border-radius: 4px">
    <h3>ğŸ’¡ Cron Expression Beispiele</h3>
    <ul>
      <li><code>0 2 * * *</code> - TÃ¤glich um 2:00 Uhr</li>
      <li><code>0 */6 * * *</code> - Alle 6 Stunden</li>
      <li><code>0 0 * * 0</code> - Jeden Sonntag um Mitternacht</li>
      <li><code>*/15 * * * *</code> - Alle 15 Minuten</li>
      <li><code>0 3 1 * *</code> - Am 1. jeden Monats um 3:00 Uhr</li>
    </ul>
    <p class="text-muted">
      Format: <code>Minute Stunde Tag Monat Wochentag</code>
      <br />
      <a href="https://crontab.guru/" target="_blank">Crontab Generator â†’</a>
    </p>
  </div>
</div>
{% endblock %}
