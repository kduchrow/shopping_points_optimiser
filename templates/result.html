<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Ergebnisse - Shopping Points Optimiser</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/result.css') }}">
  </head>
  <body>
    <div class="container">
      <h1>ğŸ“Š Ergebnisse</h1>
      
      <div class="shop-info">
        <p>ğŸª <strong>Shop:</strong> {{ shop.name }}</p>
        {% if mode == 'shopping' %}
          <p>ğŸ’µ <strong>Einkaufsbetrag:</strong> â‚¬{{ amount }}</p>
        {% elif mode == 'voucher' %}
          <p>ğŸ <strong>GewÃ¼nschter Gutschein:</strong> â‚¬{{ voucher }}</p>
        {% endif %}
      </div>

      {% if mode == 'shopping' %}
        {% if has_coupons %}
          <div class="coupons-section">
            <h3>ğŸ‰ VerfÃ¼gbare Sonderaktionen fÃ¼r diesen Shop</h3>
            <div class="coupons-list">
              {% for coupon in active_coupons %}
                <div class="coupon-card">
                  <h4>{{ coupon.name }}</h4>
                  <div class="coupon-type">
                    {% if coupon.coupon_type == 'multiplier' %}
                      ğŸ”¢ {{ coupon.value }}x Multiplikator
                    {% else %}
                      ğŸ’° {{ coupon.value }}% Rabatt
                    {% endif %}
                  </div>
                  <div class="coupon-value">
                    {% if coupon.coupon_type == 'multiplier' %}
                      Ã—{{ coupon.value }}
                    {% else %}
                      -{{ coupon.value }}%
                    {% endif %}
                  </div>
                  <p style="font-size: 12px; color: #666; margin: 8px 0;">{{ coupon.description }}</p>
                  <div class="coupon-shop">
                    <strong>ğŸ“ {{ coupon.shop.name }}</strong>
                  </div>
                  {% if coupon.program %}
                    <div class="coupon-program">
                      Programm: {{ coupon.program.name }}
                    </div>
                  {% endif %}
                </div>
              {% endfor %}
            </div>
            {% if active_coupons|length > 3 %}
              <p style="font-size: 12px; color: #999; margin-top: 8px; text-align: center;">
                â† Scroll fÃ¼r mehr Coupons â†’
              </p>
            {% endif %}
          </div>
          
          <div class="warning-box">
            <strong>âš ï¸ Hinweis:</strong> FÃ¼r diesen Shop sind Sonderaktionen verfÃ¼gbar. Die Berechnungen berÃ¼cksichtigen diese automatisch.
          </div>
          
          <div class="sort-buttons">
            <button class="sort-btn active" onclick="sortResults('base', event)">ğŸ“Š Nach Basiswert</button>
            <button class="sort-btn" onclick="sortResults('coupon', event)">ğŸ‰ Mit Sonderaktionen</button>
          </div>
        {% endif %}
        
        <h2>ğŸ† Beste Programme (geschÃ¤tzter Gegenwert in â‚¬)</h2>
        <ul class="results-list" id="results-list">
          {% for r in results %}
            <li data-base-value="{{ r.euros }}" data-coupon-value="{% if r.coupon_info %}{{ r.coupon_info.euros }}{% else %}{{ r.euros }}{% endif %}">
              <div style="flex: 1;">
                <div class="program-name">{{ r.program }}</div>
                <div class="program-details">Basiswert: {{ r.points }} Punkte â†’ â‚¬{{ r.euros }}</div>
                
                {% if r.coupon_info %}
                  <div class="coupon-info">
                    <strong>ğŸ‰ Mit Sonderaktion:</strong> 
                    <span class="coupon-value">â‚¬{{ r.coupon_info.euros }}</span> 
                    ({{ r.coupon_info.points }} Punkte)
                    {% if r.coupon_info.multipliers %}
                      <br>{{ r.coupon_info.multipliers|join(', ') }}
                    {% endif %}
                    {% if r.coupon_info.discounts %}
                      <br>{{ r.coupon_info.discounts|join(', ') }}
                    {% endif %}
                    {% if r.coupon_info.unknown_combinability %}
                      <br><em style="color: #ff6600;">âš  Kombinierbarkeit unbekannt - Beide Werte angezeigt</em>
                    {% endif %}
                  </div>
                {% endif %}
              </div>
              <div class="program-value" id="value-{{ r.program|replace(' ', '-') }}">
                â‚¬{{ r.euros }}
              </div>
            </li>
          {% endfor %}
        </ul>
      {% elif mode == 'voucher' %}
        <h2>ğŸ¯ BenÃ¶tigter Umsatz nach Programm</h2>
        <ul class="results-list">
          {% for r in results %}
            <li>
              <div>
                <div class="program-name">{{ r.program }}</div>
                <div class="program-details">{{ r.req_points }} Punkte benÃ¶tigt</div>
              </div>
              <div class="program-value">â‚¬{{ r.spend }}</div>
            </li>
          {% endfor %}
        </ul>
      {% elif mode == 'contract' %}
        <h2>âœï¸ Vertragsabschluss Bonuspunkte</h2>
        <div class="info-box">
          Bei Abschluss eines Vertrages mit <strong>{{ shop.name }}</strong> erhÃ¤ltst du folgende Bonuspunkte pro Programm:
        </div>
        <ul class="results-list">
          {% for r in results %}
            <li>
              <div class="program-name">{{ r.program }}</div>
            </li>
          {% endfor %}
        </ul>
        <div class="info-box" style="margin-top: 20px;">
          â„¹ï¸ Die genauen Werte und VergÃ¼tungen findest du in der <a href="/admin" style="color: #0066cc; text-decoration: underline;"><strong>Admin-Seite</strong></a> unter "Shops & Raten".
        </div>
      {% endif %}

      <div class="nav">
        <a href="/">â† ZurÃ¼ck zur Startseite</a>
         <a href="/shop/{{ shop.id }}/suggest" style="margin-left:10px;">âœï¸ Vorschlag einreichen</a>
      </div>
    </div>
    
    <!-- Modal for scraper proposals -->
    <div id="proposalModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeProposalModal()">&times;</span>
        <h2>ğŸ¤– Scraper-Vorschlag</h2>
        <p>FÃ¼r den Shop <strong id="modalShopName"></strong> wurde automatisch ein Vorschlag erstellt:</p>
        <p id="modalReason"></p>
        <p>
          <a id="modalSourceLink" href="#" target="_blank">ğŸ“„ Quelle anzeigen</a>
        </p>
        <div class="modal-buttons">
          <button id="reviewBtn" class="modal-btn primary">âœï¸ Vorschlag reviewen</button>
          <button onclick="closeProposalModal()" class="modal-btn secondary">âœ• SchlieÃŸen</button>
        </div>
      </div>
    </div>

    <script src="{{ url_for('static', filename='js/result.js') }}"></script>
  </body>
</html>
