{% extends "base.html" %} {% block title %}Beitr√§ge - Shopping Points
Optimiser{% endblock %} {% block nav %}
<nav class="top-nav">
  <a class="nav-link" href="/">üè† Startseite</a>
  <a class="nav-link" href="/profile">üë§ Profil</a>
  <a class="nav-link" href="/proposals/new">‚ûï Neuer Beitrag</a>
</nav>
{% endblock %} {% block content %}
<div class="card wide">
  <h1>üìù Community-Beitr√§ge</h1>

  {% if current_user.role not in ['contributor', 'admin'] %}
  <div class="contributor-notice">
    ‚ö†Ô∏è Sie k√∂nnen aktuell nur ansehen. Um abzustimmen, werden Sie
    <a href="/profile">Contributor</a>.
  </div>
  {% endif %} {% if proposals_data %} {% for item in proposals_data %}
  <div class="proposal-card">
    <div class="proposal-header">
      <span class="proposal-type"
        >{{ item.proposal.proposal_type.upper() }}</span
      >
      <div class="proposal-meta">
        Von: {{ item.submitter.username }} | {{
        item.proposal.created_at.strftime('%d.%m.%Y %H:%M') }}
      </div>
    </div>

    <div class="proposal-content">
      {% if item.proposal.proposal_type == 'rate_change' %}
      <p>
        <strong>Shop:</strong> {{ item.shop.name if item.shop else
        item.proposal.shop_id }}
      </p>
      <p>
        <strong>Programm:</strong> {{ item.program.name if item.program else
        item.proposal.program_id }}
      </p>
      <p>
        <strong>Neue Points/EUR:</strong> {{
        item.proposal.proposed_points_per_eur }}
      </p>
      <p>
        <strong>Neuer Cashback %:</strong> {{
        item.proposal.proposed_cashback_pct }}
      </p>
      {% elif item.proposal.proposal_type == 'shop_add' %}
      <p><strong>Neuer Shop:</strong> {{ item.proposal.proposed_name }}</p>
      {% elif item.proposal.proposal_type == 'program_add' %}
      <p><strong>Neues Programm:</strong> {{ item.proposal.proposed_name }}</p>
      <p>
        <strong>Punktwert (EUR):</strong> {{
        item.proposal.proposed_point_value_eur }}
      </p>
      {% elif item.proposal.proposal_type == 'coupon_add' %}
      <p>
        <strong>Art der Aktion:</strong>
        {% if item.proposal.proposed_coupon_type == 'multiplier' %} üî¢
        Multiplikator {{ item.proposal.proposed_coupon_value }}x {% else %} üí∞
        Rabatt {{ item.proposal.proposed_coupon_value }}% {% endif %}
      </p>
      <p>
        <strong>Beschreibung:</strong> {{
        item.proposal.proposed_coupon_description }}
      </p>
      {% if item.shop %}
      <p><strong>Shop:</strong> {{ item.shop.name }}</p>
      {% elif item.proposal.shop_id %}
      <p><strong>Shop:</strong> {{ item.proposal.shop_id }}</p>
      {% endif %} {% if item.program %}
      <p><strong>Programm:</strong> {{ item.program.name }}</p>
      {% elif item.proposal.program_id %}
      <p><strong>Programm:</strong> {{ item.proposal.program_id }}</p>
      {% endif %}
      <p>
        <strong>Kombinierbar:</strong>
        {% if item.proposal.proposed_coupon_combinable is true %} ‚úì Ja {% elif
        item.proposal.proposed_coupon_combinable is false %} ‚úó Nein {% else %}
        ‚ùì Unbekannt {% endif %}
      </p>
      {% if item.proposal.proposed_coupon_valid_to %}
      <p>
        <strong>G√ºltig bis:</strong> {{
        item.proposal.proposed_coupon_valid_to.strftime('%d.%m.%Y') }}
      </p>
      {% endif %} {% endif %} {% if item.proposal.reason %}
      <div class="proposal-reason">
        <strong>Begr√ºndung:</strong> {{ item.proposal.reason }}
      </div>
      {% endif %} {% if item.proposal.source_url %}
      <p style="margin-top: 10px">
        <strong>Quelle:</strong>
        <a href="{{ item.proposal.source_url }}" target="_blank"
          >{{ item.proposal.source_url }}</a
        >
      </p>
      {% endif %}
    </div>

    <div class="vote-section">
      <div class="vote-count upvotes">‚ñ≤ {{ item.upvotes }}</div>
      <div class="vote-count downvotes">‚ñº {{ item.downvotes }}</div>

      {% if item.proposal.status == 'pending' %} {% if current_user.role in
      ['contributor', 'admin'] %}
      <div class="vote-buttons">
        <form
          method="post"
          action="/vote/{{ item.proposal.id }}"
          class="inline"
        >
          <input type="hidden" name="vote" value="1" />
          <button
            type="submit"
            class="btn btn-upvote {% if item.user_vote == 1 %}active{% endif %}"
          >
            {% if current_user.role == 'admin' %}üëç Admin+3{% else %}üëç Upvote{%
            endif %}
          </button>
        </form>
        <form
          method="post"
          action="/vote/{{ item.proposal.id }}"
          style="display: inline"
        >
          <input type="hidden" name="vote" value="-1" />
          <button
            type="submit"
            class="btn btn-downvote {% if item.user_vote == -1 %}active{% endif %}"
          >
            üëé Downvote
          </button>
        </form>
        {% if current_user.role == 'admin' %}
        <form
          method="post"
          action="/approve/{{ item.proposal.id }}"
          style="display: inline; margin-left: 10px"
        >
          <button type="submit" class="btn btn-warning">
            ‚úì Direkt genehmigen
          </button>
        </form>
        {% endif %}
      </div>
      {% endif %} {% else %}
      <div class="status-badge status-approved">
        ‚úì {{ item.proposal.status|upper }}
      </div>
      {% endif %}
    </div>
  </div>
  {% endfor %} {% else %}
  <div class="empty-state">
    <p>üì≠ Keine ausstehenden Beitr√§ge vorhanden.</p>
  </div>
  {% endif %}

  <h2>‚úèÔ∏è Metadaten-Vorschl√§ge</h2>
  {% if metadata_data %} {% for item in metadata_data %}
  <div class="proposal-card">
    <div class="proposal-header">
      <span class="proposal-type">METADATA_EDIT</span>
      <div class="proposal-meta">
        Von: {{ item.submitter.username if item.submitter else 'Unbekannt' }} |
        {{ item.proposal.created_at.strftime('%d.%m.%Y %H:%M') }}
      </div>
    </div>

    <div class="proposal-content">
      <p>
        <strong>Shop:</strong> {{ item.main.canonical_name if item.main else
        item.proposal.shop_main_id }}
      </p>
      {% if item.proposal.proposed_name %}
      <p><strong>Neuer Name:</strong> {{ item.proposal.proposed_name }}</p>
      {% endif %} {% if item.proposal.proposed_website %}
      <p><strong>Website:</strong> {{ item.proposal.proposed_website }}</p>
      {% endif %} {% if item.proposal.proposed_logo_url %}
      <p><strong>Logo:</strong> {{ item.proposal.proposed_logo_url }}</p>
      {% endif %} {% if item.proposal.reason %}
      <div class="proposal-reason">
        <strong>Begr√ºndung:</strong> {{ item.proposal.reason }}
      </div>
      {% endif %}
      <p style="margin-top: 10px">
        <strong>Status:</strong> {{ item.proposal.status }}
      </p>
    </div>
  </div>
  {% endfor %} {% else %}
  <div class="empty-state">
    <p>üì≠ Keine Metadaten-Vorschl√§ge vorhanden.</p>
  </div>
  {% endif %}

  <h2>üîÄ Merge-Vorschl√§ge</h2>
  {% if merge_data %} {% for item in merge_data %}
  <div class="proposal-card">
    <div class="proposal-header">
      <span class="proposal-type">MERGE_REQUEST</span>
      <div class="proposal-meta">
        Von: {{ item.submitter.username if item.submitter else 'Unbekannt' }} |
        {{ item.proposal.created_at.strftime('%d.%m.%Y %H:%M') }}
      </div>
    </div>

    <div class="proposal-content">
      <p>
        <strong>Shop A:</strong> {{ item.variant_a.source_name if item.variant_a
        else 'Unbekannt' }}
      </p>
      <p>
        <strong>Shop B:</strong> {{ item.variant_b.source_name if item.variant_b
        else 'Unbekannt' }}
      </p>
      {% if item.proposal.reason %}
      <div class="proposal-reason">
        <strong>Begr√ºndung:</strong> {{ item.proposal.reason }}
      </div>
      {% endif %}
      <p style="margin-top: 10px">
        <strong>Status:</strong> {{ item.proposal.status }}
      </p>
    </div>
  </div>
  {% endfor %} {% else %}
  <div class="empty-state">
    <p>üì≠ Keine Merge-Vorschl√§ge vorhanden.</p>
  </div>
  {% endif %}
</div>
{% endblock %}
